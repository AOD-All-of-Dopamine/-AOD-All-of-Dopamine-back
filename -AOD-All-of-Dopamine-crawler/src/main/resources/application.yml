spring:
  application:
    name: aod-crawler

  datasource:
    url: jdbc:postgresql://localhost:5432/postgres
    username: postgres
    password: 7292
    driver-class-name: org.postgresql.Driver
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000

  jpa:
    hibernate:
      ddl-auto: create  # Job Queue 테이블 자동 생성
    show-sql: false
    properties:
      hibernate:
        format_sql: true
        dialect: org.hibernate.dialect.PostgreSQLDialect
        default_schema: public
        jdbc:
          batch_size: 50
          batch_versioned_data: true
          use_streams_for_binary: true
        order_inserts: true
        order_updates: true
        default_batch_fetch_size: 50
        query:
          plan_cache_max_size: 2048
          plan_parameter_metadata_max_size: 128

  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

  cache:
    type: simple
    cache-names: traditional-recommendations,llm-recommendations

# 스케줄링 설정
scheduling:
  enabled: true

# 로깅 설정
logging:
  level:
    root: INFO
    com.example.crawler: DEBUG
    com.example.crawler.ingest: INFO
    com.example.crawler.service: INFO
    org.hibernate.SQL: WARN
    org.springframework.web: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# 모니터링 설정
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,threaddump
  endpoint:
    health:
      show-details: always
      probes:
        enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    distribution:
      percentiles-histogram:
        http:
          server:
            requests: true
    tags:
      application: ${spring.application.name}
      environment: ${spring.profiles.active:local}
    enable:
      jvm: true
      process: true
      system: true
      tomcat: true
      logback: true
      executor: true
  info:
    env:
      enabled: true

# 애플리케이션 정보
info:
  app:
    name: AOD Crawler
    description: Content Aggregation & Crawling System
    version: 1.0.0

# Sentry (에러 추적)
sentry:
  dsn: ${SENTRY_DSN:https://89985b44a757af035a6db5b3680ce954@o4510538930192384.ingest.us.sentry.io/4510538931634176}
  environment: ${spring.profiles.active:local}
  traces-sample-rate: 0.1
  logging:
    minimum-event-level: error
    minimum-breadcrumb-level: info
  send-default-pii: true
  enable-tracing: true
  tags:
    application: ${spring.application.name}
    version: ${info.app.version:1.0.0}
  ignored-exceptions-for-type: org.springframework.web.HttpRequestMethodNotSupportedException

# 서버 설정
server:
  port: 8081  # API 서버와 분리 (8080과 다른 포트)
  shutdown: graceful
  tomcat:
    threads:
      max: 200
      min-spare: 10
    max-connections: 10000
    accept-count: 100
    connection-timeout: 20000

# 크롤러 전용 설정
crawler:
  steam:
    api-key: ${STEAM_API_KEY}
    rate-limit:
      requests-per-second: 1
  tmdb:
    api-key: ${TMDB_API_KEY}
    language: ko-KR
  batch:
    size: 100
    transform-interval: 600000  # 10분

# API Keys (backward compatibility)
tmdb:
  api:
    key: ${TMDB_API_KEY}

steam:
  api:
    key: ${STEAM_API_KEY}

openai:
  api:
    key: ${OPENAI_API_KEY}
    url: https://api.openai.com/v1/chat/completions

# 추천 시스템 설정
recommendation:
  traditional:
    max-items-per-category: 10
  llm:
    max-tokens: 1500
    temperature: 0.7
    model: gpt-3.5-turbo

