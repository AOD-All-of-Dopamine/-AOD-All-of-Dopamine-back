# src/main/resources/rules/av/tmdb.yml

platformName: TMDB
domain: AV
schemaVersion: 2

fieldMappings:
  # === Contents (마스터 공통 테이블) ===
  movie_details.title: master_title
  tv_details.name: master_title
  movie_details.original_title: original_title
  tv_details.original_name: original_title
  movie_details.poster_path: poster_image_url
  tv_details.poster_path: poster_image_url
  movie_details.overview: synopsis
  tv_details.overview: synopsis

  # === av_contents (도메인 코어 테이블) ===
  av_type: domain.av_type
  movie_details.id: domain.tmdb_id
  tv_details.id: domain.tmdb_id
  movie_details.release_date: domain.release_date
  tv_details.first_air_date: domain.release_date
  movie_details.genres: domain.genres
  tv_details.genres: domain.genres

  # === platform_data.attributes (JSONB 확장 필드) ===
  watch_providers: platform.attributes.watch_providers
  # [수정] 아래 필드들을 platform.attributes로 이동
  movie_details.runtime: platform.attributes.runtime
  tv_details.number_of_seasons: platform.attributes.season_count
  movie_details.credits.cast: platform.attributes.cast
  tv_details.credits.cast: platform.attributes.cast
  movie_details.credits.crew: platform.attributes.crew
  tv_details.credits.crew: platform.attributes.crew

normalizers:
  - type: collapse_spaces
    fields: [master_title, original_title]
  - type: nfkc
    fields: [master_title, original_title]